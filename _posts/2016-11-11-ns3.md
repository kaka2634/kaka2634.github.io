---
layout: post
title:  "NS3笔记"
categories: study
tag: routing
---

* content
{:toc}




# NS3

## 1.安装NS3

安装参考<https://www.nsnam.org/docs/tutorial/html/getting-started.html>

相关的依赖安装：<https://www.nsnam.org/wiki/Installation>

遇到问题与解决：

1.测试生成module出错，重新clean再build一下（时间较长，需要之后修改方法）

2.virtualize安装相关依赖仍然disable：需要选择对应的pyhon2.7版本，参考<http://stackoverflow.com/questions/19256127/two-versions-of-python-on-linux-how-to-make-2-7-the-default>

## 2.使用ns3图形界面

使用AODV example

```
cd Desktop/workspace/ns-allinone-3.26/ns-3.26/
 ./waf --run aodv --vis
```

## 3. 使用PCAP tracing

参考文档，[pointToPoint](https://www.nsnam.org/docs/release/3.26/doxygen/classns3_1_1_point_to_point_helper.html#abe3ce49bfc07a9d40cead59b508b9c3e)实现了虚类[PcapHelperForDevice](https://www.nsnam.org/docs/release/3.26/doxygen/classns3_1_1_pcap_helper_for_device.html),所以可以使用PcapHelperForDevice类的成员函数EnablePcapAll();

```
pointToPoint.EnablePcapAll ("myfirst");
```

所以这句需要放在devices生成之后，否则没有devices，那么就没有pcap文件生成。
再使用

```
tcpdump -nn -tt -r myfirst-0-0.pcap
```
就够测试pcap文件了。

## gpsr文件


打开/src/gpsr/model/gpsr.cc文件，根据终端运行时错误提示, 通过find找到GetypeId方法，去掉PerimeterMode后的空格
```
TypeId
RoutingProtocol::GetTypeId (void)
{
  static TypeId tid = TypeId ("ns3::gpsr::RoutingProtocol")
    .SetParent<Ipv4RoutingProtocol> ()
    .AddConstructor<RoutingProtocol> ()
    .AddAttribute ("HelloInterval", "HELLO messages emission interval.",
                   TimeValue (Seconds (1)),
                   MakeTimeAccessor (&RoutingProtocol::HelloInterval),
                   MakeTimeChecker ())
    .AddAttribute ("LocationServiceName", "Indicates wich Location Service is enabled",
                   EnumValue (GPSR_LS_GOD),
                   MakeEnumAccessor (&RoutingProtocol::LocationServiceName),
                   MakeEnumChecker (GPSR_LS_GOD, "GOD",
                                    GPSR_LS_RLS, "RLS"))
    .AddAttribute ("PerimeterMode", "Indicates if PerimeterMode is enabled",
                   BooleanValue (false),
                   MakeBooleanAccessor (&RoutingProtocol::PerimeterMode),
                   MakeBooleanChecker ())
  ;
  return tid;
}
```
其中源文件Attribute"PerimeterMode"末尾有空格.

不能一起把包含test的example文件放入scratch目录下，把7个test文件分别都拷贝在scratch文件目录下。
```
./waf
./waf --run gpsr-test1 #不需要.cc后缀名
```

## 建立新的module

首先进入根目录下的src文件夹中，利用create-module.py 新建你自己的module。

```
$./create-module.py new-module-name#可以取任何不重复之前module的名字
```
就会在src目录下产生module模板:
```
src/
      module-name/
              bindings/
              doc/
              examples/
                      wscript
              helper/
              model/
              test/
                      examples-to-run.py
              wscript
```	
之后需要增加修改自己定义的文件，并在wscipt中增加的文件和需要已有module的绑定。

参考文章：

[creat new module 1](https://github.com/shinglyu/ns3-h264-svc/blob/master/doc/manual/source/new-modules.rst)

[creat new module 2 博主有回复问题](https://ns3programming.blogspot.fi/2016/08/creating-user-defined-module-in-ns3.html)

[creat new module 3](https://www.nsnam.org/docs/release/3.11/manual/html/new-modules.html)

[ns3官网新建model，注意是model](https://www.nsnam.org/docs/manual/html/new-models.html)